name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc weasyprint xelatex fonts-noto-cjk

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install markdown weasyprint python-pptx

      - name: Generate materials
        run: |
          bash scripts/generate_materials.sh
          python scripts/generate_slides.py

      - name: Create release package
        run: |
          mkdir -p release-package
          cp -r output/* release-package/
          cp README.md release-package/
          cp docs/*.md release-package/
          zip -r chrome-education-materials-${{ github.ref_name }}.zip release-package/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            chrome-education-materials-${{ github.ref_name }}.zip
            output/chrome_edu_workbook.pdf
          body: |
            ## 한글학교 선생님을 위한 크롬 웹브라우저 활용 교육 자료 ${{ github.ref_name }}

            ### 포함된 자료
            - 📊 슬라이드 프레젠테이션 (HTML)
            - 📚 실습 워크북 (PDF)
            - 🎯 교육 자료 및 참고 문서

            ### 사용 방법
            1. `chrome-education-materials-${{ github.ref_name }}.zip` 파일을 다운로드하여 압축 해제
            2. `index.html` 파일을 브라우저에서 열어 슬라이드 확인
            3. `chrome_edu_workbook.pdf` 파일로 실습 진행

            ### 온라인 버전
            - 웹 슬라이드: https://linuxsw.github.io/chrome_lecture_for_korean_teacher/
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
