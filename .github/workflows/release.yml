name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc weasyprint xelatex fonts-noto-cjk

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install markdown weasyprint python-pptx

      - name: Generate materials
        run: |
          bash scripts/generate_materials.sh
          python scripts/generate_slides.py

      - name: Create release package
        run: |
          mkdir -p release-package
          cp -r output/* release-package/
          cp README.md release-package/
          cp docs/*.md release-package/
          zip -r chrome-education-materials-${{ github.ref_name }}.zip release-package/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            chrome-education-materials-${{ github.ref_name }}.zip
            output/chrome_edu_workbook.pdf
          body: |
            ## í•œê¸€í•™êµ ì„ ìƒë‹˜ì„ ìœ„í•œ í¬ë¡¬ ì›¹ë¸Œë¼ìš°ì € í™œìš© êµìœ¡ ìë£Œ ${{ github.ref_name }}

            ### í¬í•¨ëœ ìë£Œ
            - ğŸ“Š ìŠ¬ë¼ì´ë“œ í”„ë ˆì  í…Œì´ì…˜ (HTML)
            - ğŸ“š ì‹¤ìŠµ ì›Œí¬ë¶ (PDF)
            - ğŸ¯ êµìœ¡ ìë£Œ ë° ì°¸ê³  ë¬¸ì„œ

            ### ì‚¬ìš© ë°©ë²•
            1. `chrome-education-materials-${{ github.ref_name }}.zip` íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì••ì¶• í•´ì œ
            2. `index.html` íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ ìŠ¬ë¼ì´ë“œ í™•ì¸
            3. `chrome_edu_workbook.pdf` íŒŒì¼ë¡œ ì‹¤ìŠµ ì§„í–‰

            ### ì˜¨ë¼ì¸ ë²„ì „
            - ì›¹ ìŠ¬ë¼ì´ë“œ: https://linuxsw.github.io/chrome_lecture_for_korean_teacher/
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
